<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="../public/show_event.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
    <style>
        .section {
            overflow: hidden;
            transition: height 0.3s ease-out;
            height: auto;
        }
    </style>
</head>

<body>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
        crossorigin="anonymous"></script>
    <h2>Events</h2>
    <div class="table-wrapper">
        <table class="table table-hover">
            <thead>
                <tr>
                    <th>Event Name</th>
                    <th>Registration Date</th>
                    <th>Event Date</th>
                    <th>Event Time</th>
                    <th>Event Type</th>
                    <th>Event Status</th>
                    <th>Event Scope</th>
                    <th>Event Code</th>
                </tr>
            </thead>

            {{#data}}
            <tbody class="toggle-button" id="body{{@index}}">
                <tr>

                    <td>{{event_name}}</td>
                    <td>{{date.registration}}</td>
                    <td>{{date.event_date}}</td>
                    <td>{{time}}</td>
                    <td>{{type}}</td>
                    <td>{{status}}</td>
                    <td>{{scope.scope}}</td>
                    <td><button type="button" value={{scope.code}} class="code_class btn btn-sm btn-outline btn-success"
                            id=code-{{@index}} onclick="fun({{@index}})">Copy Code</button></td>
                    <td>
                        <form method='post' action='/edit_event'><button type="submit" value={{scope.code}}
                                class="code_class btn btn-sm btn-outline btn-success" name='Edit'>Edit
                                Me</button></form>
                    </td>
                    <td>
                        <script>function sure() { return confirm('are you sure?'); }</script>
                        <form method='post' action='/delete_event' onsubmit="return sure();"><button type="submit"
                                value={{scope.code}} class="code_class btn btn-sm btn-outline btn-success"
                                name='Edit'>Delete
                                Me</button></form>

                    </td>
                </tr>
                <tr>
                    <td colspan="10" style="margin:0;padding:0">
                        <form class="section collapsible" id="form{{@index}}" action="/get_list" method="post">
                            <button id="data{{@index}}" name="attendee" style="width:100%" value="{{scope.code}}">
                                Get attendee list
                            </button>
                        </form>
                    </td>
                </tr>

            </tbody>
            {{/data}}

        </table>
    </div>
    <script defer>
        function fun(a) {
            let str = document.getElementById(`code-${a}`).value
            navigator.clipboard.writeText(str);

            document.execCommand("copy");
            alert(`copied code`)
        }
        // This is the important part!

        function collapseSection(element) {
            // get the height of the element's inner content, regardless of its actual size
            var sectionHeight = element.scrollHeight;

            // temporarily disable all css transitions
            var elementTransition = element.style.transition;
            element.style.transition = '';

            // on the next frame (as soon as the previous style change has taken effect),
            // explicitly set the element's height to its current pixel height, so we 
            // aren't transitioning out of 'auto'
            requestAnimationFrame(function () {
                element.style.height = sectionHeight + 'px';
                element.style.transition = elementTransition;

                // on the next frame (as soon as the previous style change has taken effect),
                // have the element transition to height: 0
                requestAnimationFrame(function () {
                    element.style.height = 0 + 'px';
                });
            });

            // mark the section as "currently collapsed"
            element.setAttribute('data-collapsed', 'true');
        }

        function expandSection(element) {
            // get the height of the element's inner content, regardless of its actual size
            var sectionHeight = element.scrollHeight;

            // have the element transition to the height of its inner content
            element.style.height = sectionHeight + 'px';

            // when the next css transition finishes (which should be the one we just triggered)
            element.addEventListener('transitionend', function (e) {
                // remove this event listener so it only gets triggered once
                element.removeEventListener('transitionend', arguments.callee);

                // remove "height" from the element's inline styles, so it can return to its initial value
                element.style.height = null;
            });

            // mark the section as "currently not collapsed"
            element.setAttribute('data-collapsed', 'false');
        }

        for (var k of document.getElementsByClassName('toggle-button')) {
            k.addEventListener('click', function (e) {
                var id = this.id.substr(4);
                var section = document.getElementById('form' + id);
                var isCollapsed = section.getAttribute('data-collapsed') === 'true';

                if (isCollapsed) {
                    expandSection(section)
                    section.setAttribute('data-collapsed', 'false')
                } else {
                    collapseSection(section)
                }
            });
            k.click();
        }
    </script>

</body>

</html>