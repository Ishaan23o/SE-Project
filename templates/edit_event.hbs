<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="../public/notif_js_css/notif.css">
    <link rel="stylesheet" href="../public/create_event/check.css">


</head>

<body>

    <header style="position:absolute;top:0;" class='ghanti'>
        <nav class="navbar ghanti">
            <div class="logo ghanti">
                <ion-icon name="logo-steam"></ion-icon>
            </div>

            <div class="navlinks ghanti">
                <a href="#" class="navlink active ghanti">Loja</a>
                <a href="#" class="navlink ghanti">Biblioteca</a>
                <a href="#" class="navlink ghanti">Comunidade</a>
                <a href="#" class="navlink ghanti">Ajuda</a>
            </div>

            <div class="nav-info ghanti">
                <div class="notification ghanti">
                    <div class="notBtn ghanti" href="#">
                        <ion-icon name="notifications-outline" style="padding-top: 5px;"></ion-icon>
                        <!--Number supports double digets and automaticly hides itself when there is nothing between divs -->

                        <div class="box ghanti">
                            <div class="display ghanti">
                                <div class="nothing ghanti">
                                    <i class="fas fa-child stick ghanti"></i>
                                    <div class="cent ghanti">Looks Like your all caught up!</div>
                                </div>
                                {{#if event_data}}
                                {{#if (notEmpty event_data.Events)}}
                                <div class="cont ghanti">
                                    <!-- Fold this div and try deleting evrything inbetween -->
                                    {{#each event_data.Events}}
                                    <div class="sec new ghanti">
                                        <form action="/notif_clicked" method="get">
                                            <input type="hidden" name="event" value="{{@key}}">
                                            <div class="txt ghanti" onclick="this.parentNode.submit()"
                                                style='padding-left:15%'>
                                                There has been an Update
                                                to event
                                                {{this.name}}!!</div>
                                            <div class="txt sub ghanti" onclick="this.parentNode.submit()">Edited on:
                                                {{#formatTime
                                                this.time
                                                "YYYY-MM-DD"}}{{/formatTime}}</div>
                                        </form>
                                    </div>
                                    {{/each}}
                                </div>
                                {{/if}}
                                {{/if}}
                            </div>
                        </div>
                    </div>
                </div>
                <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js">
                </script>
                <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
                <script src="../public/notif_js_css/notif.js"></script>
                <div class="messages">

                </div>

                <div class="profile ghanti">
                    <div class="user-img ghanti"></div>
                    <ion-icon name="chevron-down-outline"></ion-icon>
                </div>
            </div>
    </header>
    <script>
        let num_req = 1;
        let con_req = 1;
    </script>

    <h1 style="color: aliceblue; margin-left: 670px; padding-top: 50px;">CREATE EVENT</h1>
    <!-- <div class="card-layer" style="height: 1100px; width: 950px; background-image: linear-gradient(rgba(4,9,30,0.7), rgba(4,9,30,0.7));" > -->
    <div class="card-layer" style="height: 1100px; width: 1150px; margin-right: 210px;  margin-bottom: 1%; ">
        <!-- background-image:linear-gradient(45deg,#bd0480,#e88e06) -->
        <!-- style="background-image:linear-gradient(170deg,#ed44b5,#eab043,#ffffff)" -->

        <div class="card-pay"
            style="height: 83%; width: 1400px; margin-left: 70px; border-radius: 60px;  margin-bottom: 1%;overflow-y: scroll;">
            <div class="container-fluid" style="height: 90%; margin: 1%;">
                <div class="row" style=" height: 95%px; margin-bottom: 1%;">
                    <div class="col-md-12">
                        <form action="/edited_event" method="post" style="margin: 1%;">
                            <input type='hidden' value={{data.scope.code}} name='code'>
                            <div class="form-group">
                                <div class="input_box">
                                    <input class="form-control" name="event_name" id="event_name" required
                                        value='{{data.event_name}}' placeholder="Event Name">
                                </div><br>
                            </div>
                            <div class="form-group">
                                <div class="input_box">
                                    <input type="date" class="form-control" name="event_date" id="event_date" min=""
                                        required
                                        value='{{#formatTime data.date.event_date "YYYY-MM-DD"}}{{/formatTime}}'
                                        placeholder="Event Date" style="color:#4d5259;">
                                </div>
                            </div>
                            <br>
                            <br>
                            <div class="form-group">
                                <div class="input_box">
                                    <textarea class="form-control" name="event_desc" id="event_desc" required
                                        style='overflow:hidden;resize:none;'
                                        placeholder="Event Description">{{data.description}}</textarea>
                                </div>
                            </div>
                            <br>
                            <div class="form-group">
                                <div class="input_box">
                                    <input type="number" min="0" max="10000" class="form-control" name="event_fee"
                                        id="event_fee" value='{{data.fees}}' required placeholder="Event Fee">
                                </div>
                            </div>
                            <br>
                            <div class="form-group">
                                <div class="input_box">
                                    <div style="margin-left: 20px; font-size: larger;"> Registration Date </div>
                                    <input type="date" class="form-control" name="registration_date"
                                        id="registration_date"
                                        value='{{#formatTime data.date.registration_date "YYYY-MM-DD"}}{{/formatTime}}'>
                                </div>
                            </div>
                            <br>
                            <br>
                            <div class="form-group">
                                <div class="input_box">
                                    <div style="margin-left: 20px; font-size: larger;"> Event Time </div>
                                    <input type="time" class="form-control" name="event_time" id="event_time" required
                                        value="{{data.time}}">
                                </div>
                            </div>
                            <br>
                            <br>
                            <div style="display: flex; margin-left: 10px;">
                                <div class="form-group">
                                    <div class="input_box" style="display: flex; margin-left: 59px; ">
                                        <div style="margin-left: 2px; font-size: larger;"> Event Type </div>
                                        <div style="margin-left: 40px;">
                                            <div class="select">
                                                <select name="event_type" id="event_type" class="form-control" required>
                                                    <option value="online" {{#ifEquals data.type 'online'
                                                        }}selected{{/ifEquals}}><span style="color: black;">
                                                            Online</span>
                                                    </option>
                                                    <option value="offline" {{#ifEquals data.type 'offline'
                                                        }}selected{{/ifEquals}}>Offline
                                                    </option>
                                                    <option value="hybrid" {{#ifEquals data.type 'hybrid'
                                                        }}selected{{/ifEquals}}>Hybrid
                                                    </option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>


                                <div class="form-group" style="margin-left: 200px;">
                                    <div class="input_box" style="display: flex; margin-left: 30px;">
                                        <div style="margin-left: 1px; font-size: larger;"> Event Scope </div>
                                        <div style="margin-left: 40px;">
                                            <select name="event_scope" id="event_scope" class="form-control"
                                                style="background-color: rgb(249, 243, 237);" required>
                                                <option value="private" {{#ifEquals data.scope.scope 'private'
                                                    }}selected{{/ifEquals}}>
                                                    Private</option>
                                                <option value="public" {{#ifEquals data.scope.scope 'public'
                                                    }}selected{{/ifEquals}}>Public
                                                </option>
                                            </select>
                                        </div>
                                    </div>
                                </div>

                            </div>
                            <div class="form-group" style="margin-left: 72px; display: inline-flex;">
                                <label for="exampleInputFile" style="width: 200px;">
                                    <div style="margin-left: 0px; font-size: larger;"> Upload Brochure </div>
                                </label>
                                <div class="input_box" style="margin-left: 0px;">
                                    <input type="file" class="form-control-file" id="exampleInputFile" placeholder="hcd"
                                        style="color: #4d5259;">
                                </div>
                            </div>
                            <br><br>
                            <div style="display: flex;">
                                <div class="form-group" id="req" style="  margin-left: 54px;">
                                    <label style="display:inline-block">
                                        <div style="margin-left: 20px; font-size: larger;">Add Requirements </div>
                                    </label>
                                    <button type="button" id="req_add" style="display:inline-block">+</button>
                                    <br>
                                </div>
                                <script>
                                    //Relabel after deletion
                                    document.getElementById("req_add").addEventListener("click", () => {
                                        if (num_req > 10) {
                                            alert("Maximum of 10 descriptions allowed");
                                            return false;
                                        }
                                        let req = document.getElementById('req');
                                        let isadd = 1;
                                        if (num_req > 1) {
                                            for (let i = 1; i < num_req; i++) {
                                                let check = document.getElementById(`req-${i}`).value;
                                                if (!check) { alert("requirements cant be empty"); isadd = 0; break; }
                                            }
                                        } if (isadd === 1) {

                                            //Input tag
                                            const div = document.createElement('div');
                                            div.classList.add('input_box')
                                            div.setAttribute('id', `req_div-${num_req}`);
                                            div.setAttribute('style', 'margin-left:20px');
                                            const inputnode = document.createElement("input")
                                            inputnode.setAttribute("type", "text")
                                            inputnode.setAttribute("class", "form-control")
                                            inputnode.setAttribute("id", `req-${num_req}`)
                                            inputnode.setAttribute("name", "req_control")
                                            inputnode.setAttribute('placeholder', `Enter requirement ${num_req}`);
                                            div.append(inputnode)
                                            req.append(div);

                                            //Delete Button
                                            const delbutton = document.createElement('button');
                                            delbutton.setAttribute('id', `del_req-${num_req}`);
                                            delbutton.setAttribute('class', 'btn btn-primary');
                                            delbutton.setAttribute('type', 'button');
                                            delbutton.textContent = 'delete requirement';
                                            delbutton.addEventListener('click', () => {
                                                var id = delbutton.id.substr(8);
                                                req.removeChild(document.getElementById('req_div-' + id));
                                                req.removeChild(document.getElementById('del_req-' + id));
                                                req.removeChild(document.getElementById('br_req-' + id));

                                                //Change labels now that one less requirement is there
                                                var labels = document.getElementsByClassName("req_label");
                                                for (var k = 0; k < labels.length; k++) {
                                                    labels[k].textContent = `Enter requirement ${k + 1}`;
                                                }
                                                num_req--;
                                            })
                                            req.append(delbutton);

                                            //Br tag for every requirement
                                            const br = document.createElement('br');
                                            br.setAttribute('id', `br_req-${num_req}`);
                                            req.append(br);
                                            num_req++;
                                        }
                                    })

                                    //Helper function for generating all requirements already defined
                                    function gen_req_button(text) {
                                        document.getElementById("req_add").click();
                                        document.getElementById(`req-${num_req - 1}`).value = text;
                                    }
                                </script>
                                {{#data.requirements}}
                                <script>
                                    gen_req_button('{{ this}}');
                                </script>
                                {{/data.requirements}}
                                <div class="form-group" id="contact" style="margin-left: 290px;">
                                    <label style=" font-size: larger;margin-left:6px">
                                        Add Contacts
                                    </label>
                                    <button type="button" id="con_add">+</button>
                                    <br>
                                </div>
                            </div>
                            <script>
                                function addcon() {
                                    var req = document.getElementById('contact');
                                    const div = document.createElement('div');
                                    div.classList.add('input_box')
                                    div.setAttribute('id', `con_div-${con_req}`);
                                    const inputnode = document.createElement("input")
                                    inputnode.setAttribute('placeholder', `Enter contact ${con_req}`);
                                    inputnode.setAttribute("type", "text")
                                    inputnode.setAttribute("class", "form-control")
                                    inputnode.setAttribute("id", `con-${con_req}`)
                                    inputnode.setAttribute("name", "con_control")
                                    inputnode.setAttribute("pattern", '[0-9]{10}')
                                    inputnode.setAttribute("required", 'true')
                                    div.append(inputnode)
                                    req.append(div);

                                    //Delete Button
                                    const delbutton = document.createElement('button');
                                    delbutton.setAttribute('id', `del_con-${con_req}`);
                                    delbutton.setAttribute('class', 'btn btn-primary');
                                    delbutton.setAttribute('type', 'button');
                                    delbutton.textContent = 'delete contact';
                                    delbutton.addEventListener('click', () => {
                                        var id = delbutton.id.substr(8);
                                        console.log(id);
                                        req.removeChild(document.getElementById('con_div' + id));
                                        req.removeChild(document.getElementById('del_con-' + id));
                                        req.removeChild(document.getElementById('br_con-' + id));
                                        //Change labels now that one less requirement is there
                                        var labels = document.getElementsByClassName("con_label");
                                        for (var k = 0; k < labels.length; k++) {
                                            labels[k].textContent = `Enter contact ${k + 1}`;
                                        }
                                        con_req--;
                                    })
                                    req.append(delbutton);

                                    //Br tag for every requirement
                                    const br = document.createElement('br');
                                    br.setAttribute('id', `br_con-${con_req}`);

                                    req.append(br);


                                    con_req++;
                                }
                                document.getElementById("con_add").addEventListener("click", () => {
                                    if (con_req > 4) {
                                        alert("Maximum of 4 contacts allowed");
                                        return false;
                                    }
                                    for (let i = 1; i < con_req; i++) {
                                        let check = document.getElementById(`con-${i}`).value;
                                        if (!check) {
                                            alert("contact cant be empty")
                                            return false;
                                        }
                                    }
                                    addcon();
                                })
                                document.getElementById('event_date').min = new Date().toISOString().substr(0, 10);
                                function gen_con_button(text) {
                                    document.getElementById("con_add").click();
                                    document.getElementById(`con-${con_req - 1}`).value = text;
                                }
                            </script>
                            {{#data.contact}}
                            <script>
                                gen_con_button({{ this}});
                            </script>
                            {{/data.contact}}
                            <div class="form-group">
                                <div class="input_box">
                                    <label for="notif">Send a Notification?</label>
                                    <input type="checkbox" id="notif" name="notif" value="set"
                                        style='width:auto;height:auto;margin-left:175px;margin-top:14px;' />
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary " id="Submit"
                                style="margin-left: 44%; margin-top: 9%;margin-bottom:10%">
                                Submit
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="../public/js/jquery.min.js"></script>
    <script src="../public/js/bootstrap.min.js"></script>
    <script src="../public/js/scripts.js"></script>;


</body>

</html>